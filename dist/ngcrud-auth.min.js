/*! ng-crud-auth 2015-10-16 */
!function(a){var b=a.module("authModule",["ngCookies","ngRoute"]);b.constant("defaultStatus",{status:!1}),b.config(["$routeProvider","authServiceProvider",function(a,b){var c=b.getValues();a.when(c.loginPath,{templateUrl:"src/templates/login.html",controller:"authController",controllerAs:"authCtrl"}).when(c.registerPath,{templateUrl:"src/templates/register.html",controller:"authController",controllerAs:"authCtrl"}).when(c.forbiddenPath,{templateUrl:"src/templates/forbidden.html",controller:"authController",controllerAs:"authCtrl"})}]),b.config(["$httpProvider","authServiceProvider",function(a,b){a.interceptors.push(["$q","$log","$location",function(a,c,d){return{responseError:function(e){return 401===e.status&&(c.debug("error 401",e),d.path(b.getValues().loginPath)),403===e.status&&(c.debug("error 403",e),d.path(b.getValues().forbiddenPath)),a.reject(e)}}}])}])}(window.angular),function(a){var b=a.module("authModule");b.controller("authController",["$scope","$cookies","$location","authService","defaultStatus",function(a,b,c,d,e){this.errorctrl=e,a.roles=d.getRoles(),a.isAuthenticated=function(){return!!d.getCurrentUser()},a.user={};for(var f in a.roles){a.user.role=f;break}a.currentUser=function(){var a=d.getCurrentUser();return a&&a.name},this.login=function(a){var b=this;a&&a.userName&&a.password&&d.login(a).then(function(a){console.log("success",a)},function(a){b.errorctrl={status:!0,type:"danger",msg:":"+a.data}})},a.logout=function(){d.logout()},a.log=function(a){console.log(a)},this.close=function(){this.errorctrl=e},this.registration=function(){d.registration()},this.register=function(a){var b=this;a.password!==a.confirmPassword?this.errorctrl={status:!0,type:"warning",msg:": Passwords must be equals"}:d.register(a).then(function(a){b.errorctrl={status:!0,type:"success",msg:": User registered successfully"}},function(a){b.errorctrl={status:!0,type:"danger",msg:":"+a.data}})},a.goToLogin=function(){d.goToLogin()},this.goBack=function(){d.goToBack()},a.goToSuccess=function(){d.goToSuccess()}}])}(window.angular),function(a){var b=a.module("authModule");b.directive("loginButton",[function(){return{scope:{},restrict:"E",templateUrl:"src/templates/button.html",controller:"authController"}}])}(window.angular),function(a){var b=a.module("authModule");b.provider("authService",function(){var b={apiUrl:"webresources/users/",successPath:"/product",loginPath:"/login",registerPath:"/register",logoutRedirect:"/login",loginURL:"login",registerURL:"register",logoutURL:"logout",nameCookie:"user",forbiddenPath:"/forbidden"},c={user:"Client",provider:"Provider"};this.setValues=function(c){b=a.extend(b,c)},this.getValues=function(){return b},this.getRoles=function(){return c},this.setRoles=function(a){c=a},this.$get=["$cookies","$location","$http",function(a,d,e){return{getRoles:function(){return c},login:function(c){return e.post(b.apiUrl+b.loginURL,c).then(function(c){a.putObject(b.nameCookie,c),d.path(b.successPath)})},getConf:function(){return b},logout:function(){return e.get(b.apiUrl+b.logoutURL).then(function(){a.remove(b.nameCookie),d.path(b.logoutRedirect)})},register:function(a){return e.post(b.apiUrl+b.registerURL,a).then(function(a){d.path(b.loginPath)})},registration:function(){d.path(b.registerPath)},getCurrentUser:function(){var c=a.getObject(b.nameCookie);return c?{id:c.id,name:c.userName}:null},goToLogin:function(){d.path(b.loginPath)},goToBack:function(){d.path(b.loginPath)},goToSuccess:function(){d.path(b.successPath)},goToForbidden:function(){d.path(b.forbiddenPath)}}}]})}(window.angular),angular.module("authModule").run(["$templateCache",function(a){"use strict";a.put("src/templates/button.html",'<button ng-hide="isAuthenticated()" type="button" class="btn btn-default navbar-btn" ng-click="goToLogin()"><span class="glyphicon glyphicon-user" aria-hidden="true"></span> Login</button><div ng-show="isAuthenticated()" class="btn-group"><button type="button" class="btn btn-default dropdown-toggle navbar-btn" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">{{currentUser()}} <span class="caret"></span></button><ul class="dropdown-menu"><li><a href ng-click="logout()"><span class="glyphicon glyphicon-log-out" aria-hidden="true"></span> Logout</a></li></ul></div>'),a.put("src/templates/forbidden.html",'<div class="jumbotron"><h1>Oups,Forbidden!</h1><p>You don\'t have permissions for this resource!</p><p><a class="btn btn-primary btn-lg" ng-click="goToSuccess()" role="button">Back</a></p></div>'),a.put("src/templates/login.html",'<div><div class="col-md-5 col-md-offset-4"><div class="col-md-12" ng-show="authCtrl.errorctrl.status" ng-message="show"><div class="alert alert-{{authCtrl.errorctrl.type}}" role="alert"><button type="button" class="close" ng-click="authCtrl.close()" aria-label="Close"><span aria-hidden="true">&times;</span></button> <strong>{{authCtrl.errorctrl.type| uppercase}}</strong> {{authCtrl.errorctrl.msg}}</div></div><div class="col-md-12"><div class="panel panel-default"><div class="panel-heading"><h3 class="panel-title">Please Login</h3></div><div class="panel-body"><form name="loginform" accept-charset="UTF-8" role="form"><div class="form-group"><input class="form-control" required ng-model="user.userName" placeholder="Username or Email" name="username" type="text"></div><div class="form-group"><input class="form-control" required ng-model="user.password" placeholder="Password" name="password" type="password"></div><div class="checkbox"><label><input name="rememberMe" type="checkbox" ng-model="user.rememberMe" value="false"> Remember Me</label></div><input class="btn btn-lg btn-success btn-block" ng-click="authCtrl.login(user)" type="submit" value="Login"></form><button class="btn btn-lg btn-default btn-block" ng-click="authCtrl.registration()">Register</button></div></div></div></div></div>'),a.put("src/templates/register.html",'<div><div class="col-md-5 col-md-offset-4"><div class="panel panel-default"><div class="panel-heading"><h3 class="panel-title">Please Register</h3><div style="padding-top: 30px" class="col-md-12" ng-show="authCtrl.errorctrl.status" ng-message="show"><div class="alert alert-{{authCtrl.errorctrl.type}}" role="alert"><button type="button" class="close" ng-click="authCtrl.close()" aria-label="Close"><span aria-hidden="true">&times;</span></button> <strong>{{authCtrl.errorctrl.type| uppercase}}</strong> {{authCtrl.errorctrl.msg}}</div></div></div><div class="panel-body"><form name="loginform" accept-charset="UTF-8" role="form"><div class="form-group"><input class="form-control" required ng-model="user.userName" placeholder="Username" name="username" type="text"></div><div class="form-group"><input class="form-control" required ng-model="user.password" placeholder="Password" name="password" type="password"></div><div class="form-group"><input class="form-control" required ng-model="user.confirmPassword" placeholder="Confirm Password" name="confirmpassword" type="password"></div><div class="form-group"><input class="form-control" required ng-model="user.name" placeholder="Name" name="name" type="text"></div><div class="form-group"><input class="form-control" required ng-model="user.lastName" placeholder="LastName" name="lastname" type="text"></div><div class="form-group"><label for="SelectRole">Please select your role:</label><select class="form-control" ng-options="key as value for (key, value) in roles" name="SelectRole" ng-model="user.role" required></select></div><div class="form-group"><input class="form-control" required ng-model="user.email" placeholder="email" name="email" type="email"></div><input class="btn btn-lg btn-primary btn-block" ng-click="authCtrl.register(user)" type="submit" value="Register"> <input class="btn btn-lg btn-default btn-block" ng-click="authCtrl.goBack()" type="submit" value="Go Back"></form></div></div></div></div>')}]);